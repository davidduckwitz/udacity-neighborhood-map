<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta http-equiv="content-language" content="en">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- The above 4 meta tags *must* come first in the head; any other head content must come *after* these tags -->
	<meta name="description" content="Udacity Fullstack Nanodegree Project 'Neighborhood Map' by David Duckwitz">
	<meta name="keywords" content="udacity, fullstack nanodegree, david duckwitz, map, knockout">
	<meta name="author" content="David Duckwitz">
	<!-- Other Metas -->
	<meta name="page-topic" content="Bildung">
	<meta name="copyright" content="David Duckwitz">
	<meta name="page-type" content="Private Homepage">
	<meta name="audience" content="Alle">	
	<meta name="robots" content="index, follow">
	<meta name="DC.Creator" content="David Duckwitz">
	<meta name="DC.Publisher" content="David Duckwitz">
	<meta name="DC.Rights" content="David Duckwitz">
	<meta name="DC.Description" content="Udacity Fullstack Nanodegree Project 'Neighborhood Map' by David Duckwitz">
	<meta name="DC.Language" content="en">
    
    <title>Neighborhood-Map</title>
	
    <!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">	
	
	<!-- Load rest of the Scripts on the end to speedup loading -->
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	
	<!-- 
		Thanks to URL: http://opensoul.org/2011/06/23/live-search-with-knockoutjs/  
			= Knockout Live Search (Filter)
		Thanks to URL: https://stackoverflow.com/questions/18798520/how-to-add-custom-animation-on-google-map-v3-marker-when-i-drop-each-marker-one
			= GMap Marker Animation
		Thanks to URL : https://developers.google.com/maps/documentation/javascript/examples/infowindow-simple?hl=de
			= GMap Info Window
		Thanks to URL: https://developers.google.com/maps/documentation/javascript/examples/style-array?hl=de
			= GMap Nightmode Style
		Thanks to URL: https://developers.google.com/maps/documentation/javascript/examples/marker-simple?hl=de
			= Add Marker to GMap
	-->
</head>
<body>
	<!-- Navbar Top -->
    <nav class="navbar navbar-default">
	  <div class="container-fluid">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
		  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
			<span class="sr-only">Toggle navigation</span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		  </button>
		  <a class="navbar-brand" href="#"><span lang="en">Dave's Favorite Places</span></a>
		</div>
		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
		  <ul class="nav navbar-nav">
			<li class="active"><a href="/"><span lang="en">Map</span> <span class="sr-only">(current)</span></a></li>			
		  </ul>
		  <ul class="nav navbar-nav navbar-right">			
			<li class="dropdown">
			  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span lang="en">Menu</span> <span class="caret"></span></a>
			  <ul class="dropdown-menu">
				<li><a href="https://github.com/davidduckwitz/udacity-neighborhood-map"><span lang="en">Git-Repository</span></a></li>
				<li role="separator" class="divider"></li>
				<li><a href="https://freebitco.in/?r=647549"><span lang="en">Get Free Bitcoins</span></a></li>
			  </ul>
			</li>
		  </ul>		  
		</div><!-- /.navbar-collapse -->
	  </div><!-- /.container-fluid -->
	</nav>
	<!-- Navbar Bottom -->
	<nav class="navbar navbar-default navbar-fixed-bottom">
	  <div class="container-fluid text-center">
		<ul class="nav navbar-nav">
			<li class="navbar-item" style="padding-top: 17px;"><span lang="en">Choose Language:</span></li>
			<li class="navbar-item"><a href="#" style="background-size: 100%; width: 70px;" onclick="window.lang.change('en'); return false;"><span lang="en">English</span></a></li>
			<li class="navbar-item"><a href="#" style="background-size: 100%; width: 70px;" onclick="window.lang.change('de'); return false;"><span lang="en">Deutsch</span></a></li>
			<!-- Zum anzeigen von Flaggen: class="flag-icon flag-icon-de btn btn-default" -->
		</ul>
			<center><a href="https://freebitco.in/?r=647549"><img class="img-responsive" src="https://static1.freebitco.in/banners/468x60-3.png"></a></center>
	  </div><!-- /.container-fluid -->
	</nav>
	
<!-- Main Content -->
 <div class="container-fluid">
	<div class="row">
		<div class="col-md-3 panel panel-default" style="">
			<div style="overflow-y: auto; height: 70vh;">
				<header>
					<!-- knockout Filter Input -->
					<form action="#">
						<div class="input-group">
						<span class="input-group-addon" onclick="window.location.reload();" id="basic-addon1">Reset</span>
						<input class="form-control" lang="en" placeholder="Searchâ€¦" type="search" name="q" data-bind="value: query, valueUpdate: 'keyup'" autocomplete="off" aria-describedby="basic-addon1">
						</div><span lang="en">Click Reset to show all places / reset the view</span>
					</form>
					<hr>
				 </header>
				<div class="content">
					<ul class="media-list" data-bind="template: {name:'place', foreach:places}"></ul>
				</div>
			</div>
			<div style="overflow-y: auto; height: 25vh;">
				<ul class="media-list">
					<li class="media">
						<div class="media">
						  <div class="media-left">
							<a href="#">
							  <img class="media-object" src="/static/images/Earthquakes-50(1).png" alt="...">
							</a>
						  </div>
						  <div class="media-body">
							<h5 class="media-heading"><strong lang="en">Earthquakewarnings</strong></h5>
						  </div>
						</div> 
					</li>
				</ul>
			</div>
		</div>
		<div class="col-md-9 panel panel-default">
			<div id="gmap" style="width: 100%; height: 90vh;"></div>
		</div>
	</div>
 </div>
	
<!-- Knockout Template for each Place -->	
<script data-proofer-ignore type="text/html" id="place">
	<li class="media" onclick="loadPlace( this.id );" data-bind="attr:{id: id}">
		<div class="media">
		  <div class="media-left">
			<a href="#">
			  <img class="media-object" data-bind="attr:{src: icon}" alt="...">
			</a>
		  </div>
		  <div class="media-body">
			<h5 class="media-heading"><strong lang="en" data-bind="text: title"></strong></h5>
			<span lang="en" data-bind="text: description"></span>
			<br>
			<small>
				<i><span lang="en" data-bind="text: date"></span></i>
			</small>
			<hr>
		  </div>
		</div> 
	</li>
</script>
     
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="static/js/jquery.min.js"></script>	
	<script src="static/js/js.cookie.js" charset="utf-8" type="text/javascript"></script>
	<script src="static/js/jquery-lang.js" charset="utf-8" type="text/javascript"></script>
	<!-- <script src="js/langpack/nonDynamic.js" charset="utf-8" type="text/javascript"></script> -->
	<!-- Include all compiled plugins (below), or include individual files as needed -->
    <!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<!-- Knockout.js  -->
	<script src='http://knockoutjs.com/downloads/jquery.tmpl.min.js'></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/knockout/1.2.1/knockout-min.js"></script>
	<script src="static/js/places.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCdziLyijYagdRorrK8P_5p6KCw2keYZ6Q&callback=initMap" async defer></script>
	<script>
	// Variables
	var mapstart = {lat: 50.55809, lng: 9.68084};
	var openWeatherMapAPI = '9674e5fa9add44c373be389b10566f0a';	
	var bounds;
	var markers = [];
	var map;
	
  $(function() {
	// places are loaded from "static/js/places.js"
    var viewModel = {
      places: ko.observableArray(places),
      query: ko.observable(''),
      search: function(value) {
        viewModel.places.removeAll();
        for(var x in places) {
          if(places[x].title.toLowerCase().indexOf(value.toLowerCase()) >= 0) {
            viewModel.places.push(places[x]);
          }
        }
      }
    };
    viewModel.query.subscribe(viewModel.search);
    ko.applyBindings(viewModel);	
  });

	function initMap() {
		// Create a script tag and set the Earthquake Data....
		var script = document.createElement('script');
		script.src = 'http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_week.geojsonp';
		document.getElementsByTagName('head')[0].appendChild(script);
		bounds = new google.maps.LatLngBounds();
		
		map = new google.maps.Map(document.getElementById('gmap'), {
		  center: mapstart,
		  zoom: 5,	  
		  styles: [				
				{elementType: 'labels.text.stroke', stylers: [{color: '#242f3e'}]},
				{elementType: 'labels.text.fill', stylers: [{color: '#746855'}]},
				{
				  featureType: 'administrative.locality',
				  elementType: 'labels.text.fill',
				  stylers: [{color: '#d59563'}]
				},
				{
				  featureType: 'poi',
				  elementType: 'labels.text.fill',
				  stylers: [{color: '#d59563'}]
				},
				{
				  featureType: 'poi.park',
				  elementType: 'geometry',
				  stylers: [{color: '#263c3f'}]
				},
				{
				  featureType: 'poi.park',
				  elementType: 'labels.text.fill',
				  stylers: [{color: '#6b9a76'}]
				},
				{
				  featureType: 'road',
				  elementType: 'geometry',
				  stylers: [{color: '#38414e'}]
				},
				{
				  featureType: 'road',
				  elementType: 'geometry.stroke',
				  stylers: [{color: '#212a37'}]
				},
				{
				  featureType: 'road',
				  elementType: 'labels.text.fill',
				  stylers: [{color: '#9ca5b3'}]
				},
				{
				  featureType: 'road.highway',
				  elementType: 'geometry',
				  stylers: [{color: '#746855'}]
				},
				{
				  featureType: 'road.highway',
				  elementType: 'geometry.stroke',
				  stylers: [{color: '#1f2835'}]
				},
				{
				  featureType: 'road.highway',
				  elementType: 'labels.text.fill',
				  stylers: [{color: '#f3d19c'}]
				},
				{
				  featureType: 'transit',
				  elementType: 'geometry',
				  stylers: [{color: '#7c96bc'}]
				},
				{
				  featureType: 'transit.station',
				  elementType: 'labels.text.fill',
				  stylers: [{color: '#d59563'}]
				},
				{
				  featureType: 'water',
				  elementType: 'geometry',
				  stylers: [{color: '#17263c'}]
				},
				{
				  featureType: 'water',
				  elementType: 'labels.text.fill',
				  stylers: [{color: '#515c6d'}]
				},
				{
				  featureType: 'water',
				  elementType: 'labels.text.stroke',
				  stylers: [{color: '#17263c'}]
				}
			  ]	  
		});

		for (i = 0; i < places.length; i++) {
			loc = {lat: places[i].location.lat, lng: places[i].location.lng};
			addMarker(loc, i, false);

		}	
	}

				
	// Adds a marker to the map push to the array and set Infowindow Content.
	function addMarker(location, index, bounce) {
	var dats = places;
		console.log('Add Marker on Map for PlaceNumber '+index);	
		c = '<div class="panel panel-default">';
		c +='	<h1>';
		c +='		<span style="float: left;"><img src="'+dats[index].icon+'" class="img-responsive"></span>';
		c +='		<span style="float: right;">'+dats[index].title+'</span>';
		c +='	</h1>';
		c +='	<div class="panel-body"><br><br><hr>';
		c += dats[index].description;	
		c +='	</div>	';
		c +='	<div class="panel-footer">';
		c +='		';
		c +='		';
		c +='	</div>';
		c +='</div>';
		
		if(bounce === true){
			var marker = new google.maps.Marker({
			position: location,
			map: map,
			icon: dats[index].icon,
			animation: google.maps.Animation.DROP,
			animation: google.maps.Animation.BOUNCE
			});
		} else {
			var marker = new google.maps.Marker({
			position: location,
			map: map,
			icon: dats[index].icon
			});
		}
		
		var infowindow = new google.maps.InfoWindow({
		  content: c
		});
			  
		marker.addListener('click', function() {
		  infowindow.open(map, marker);	  
		});
		
		markers.push(marker);
	}

	// Sets the map on all markers in the array.
	function setMapOnAll(map) {
		for (var i = 0; i < markers.length; i++) {
		  markers[i].setMap(map);
		}
	}

	// Removes the markers from the map, but keeps them in the array.
	function clearMarkers() {
		setMapOnAll(null);
	}

	// Shows any markers currently in the array.
	function showMarkers() {
		setMapOnAll(map);
	}

	// Deletes all markers in the array by removing references to them.
	function deleteMarkers() {
		clearMarkers();
		markers = [];
	}

	// In search Onclick on Item
	var loadPlace = function(index) {	
		console.log('Load Place '+index);
		lat = places[index].location.lat;
		lng = places[index].location.lng;
		loc = {lat: lat, lng: lng};
		deleteMarkers();
		addMarker(loc, index, true);
		map.setCenter(loc); 
	}

	// Loop through the results array and place a marker for each Earthquake 
	window.eqfeed_callback = function(results) {
		for (var i = 0; i < results.features.length; i++) {
		  var coords = results.features[i].geometry.coordinates;
		  var latLng = new google.maps.LatLng(coords[1],coords[0]);
		  var marker = new google.maps.Marker({
			position: latLng,
			map: map,
			icon: {url: '/static/images/Earthquakes-50(1).png',
			  //size: new google.maps.Size(40, 64),	 
			  origin: new google.maps.Point(0, 0),	 
			  anchor: new google.maps.Point(0, 0)
			}
		  });
		}
	}
	  
	// Multilanguage Vars for JQUERY-Lang
	var lang = new Lang();
		lang.dynamic('de', 'static/js/langpack/de.json');
		lang.init({
			defaultLang: 'en',
			cookie: {				
				name: 'langCookie',				
				expiry: 365,
				path: '/'
			}
		}
	);
	</script>    
</body>
</html>